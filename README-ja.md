[README in English is here](https://github.com/simotin13/covme/blob/main/README.md)

# これは何？
`covme` は C/C++ 言語用のコードカバレッジツールです。

version 0.1.0 (2022/3/15)時点では、C1相当のカバレッジ計測ができます。

# サポートしているプラットフォーム
version 0.1.0 (2022/3/15)時点では X86_64 GNU/Linux での動作をサポートしています。
- Ubuntu20.04 LTS
- Ubuntu20.04(WSL2)

の環境で動作することを確認しています。

# 依存するツールについて
`covme` は プログラムのトレースに `gdb` を利用します。
従って、実行する際は `gdb` をあらかじめインストールした状態にしてください。

また、カバレッジ計測対象のプログラムはDWARF形式のデバッグ情報を含んでいる必要があります。

# 使い方
本レポジトリをダウンロードしてください。

解凍してできたフォルダ内の `covme` ファイルが実行モジュールになります。

```
./covme ./a.out
```
のようにコマンドの引数で、カバレッジ計測対象のプログラムを指定してください。

また、ターゲットプログラムがコマンドライン引数をとる場合は、モジュール名の後に続けて引数を指定してください。
```
./covme ./a.out 1 2
```

対象のプログラムの動作が終了すると、`report`フォルダにHTML形式で計測結果のレポートが生成されます。

`report`フォルダの内容は実行する度に上書きされますのでご注意ください。

# 計測対象のプログラムのビルドについて
`covme` ではカバレッジ計測にDWARF形式のデバッグ情報を利用しています。
計測対象となるプログラムをビルドする際はデバッグ情報を含む形でビルドしてください。

ビルド時のコマンド例).
```
gcc -g main.c
```

また、カバレッジ計測のため、`covme`はビルドされたプログラム中に含まれるソースコードのパスを参照しています。一度ソースコードをビルドしたら`covme`を実行する場合はソースコードを他のフォルダに移動しないでください。もしソースコードを移動した場合は再度プログラムをビルドし直してください。

# サンプルプログラムとスクリプトについて
`covme` の実行モジュールの他、使い方を理解するためのサンプル用テストコードとビルド、実行用のスクリプトを含んでいます。

## examples
examples 以下に `covme` の動作を確認するためのカバレッジ計測対象となるサンプルコードを含んでいます。

examples では以下の簡単なサンプルプログラムを含んでいます。

### C
1. function_call
   
   main関数(main.c)から他のファイルで実装された関数(calc.c)を呼び出すコード

1. with_sharedobject

   function_callと同様のコード。ただし、共有ライブラリ(.so)としてcalc.cを利用する

1. with_stdin

   標準入力からの入力(scanf)を伴う場合のコード

### C++

1. function_call
   
   main関数(main.cpp)から他のファイルで実装された関数(calc.cpp)を呼び出すコード

## サンプルプログラムのビルドと実行

### 計測対象となるソースコードのビルド
`00_build_examples.sh` を実行してください。examples以下のソースコードをビルドされます。
`00_build_examples.sh` では `gcc` コマンドがインストールされている事を想定しています。インストールされていない場合はあらかじめインストールしてください。

### サンプルプログラムのカバレッジ計測の実行
`01_try_simple_example.sh` ～ `04_try_stdin_example.sh` は `covme` を使ったカバレッジ計測の実行のサンプルスクリプトです。
`00_build_examples.sh` でのビルド完了後に試してください。

各スクリプト・プログラムの内容は以下の通りです。

1. 01_try_simple_example.sh
    
    `covme` により `examples/c/function_call` のプログラムのカバレッジを計測します。

1. 02_try_shared_object_example.sh

    共有ライブラリの関数を呼び出すプログラムのカバレッジ計測例です。

    スクリプト中で、ビルドした共有ライブラリを `/usr/local/lib` にコピーし、 `ldconfig` コマンドを実行するため sudo オプションを仕様しています。

1. 03_try_stdin_example.sh
    
    標準入力からの入力をともなるプログラムのカバレッジ計測のサンプルです。実行中にユーザーからの入力が必要になります。

1. 04_try_simple_cpp_example.sh
    
    `covme` により `examples/cpp/function_call` のプログラムのカバレッジを計測します。シンプルなC++アプリケーションカバレッジ計測例です。

# 既知の不具合について
既に認識している不具合・課題は以下の通りです。

- マルチスレッドアプリケーションの計測が十分できない場合があります。
- I/Oによる入力待ちが発生するアプリケーションの計測が十分できない場合があります。
- C++ のアプリケーションのカバレッジ計測の動作確認は十分できていません。

# ロードマップについて
将来的に予定している機能として、以下の機能の実装を検討しています。

- 既知の不具合の解消
- マルチスレッドプログラムのカバレッジ計測機能
- C2カバレッジ機能
- レポート出力内容の充実
- メモリリーク検出機能
- ARMアーキテクチャのサポート(ARMv7,AArch64)
- 組込向けCPUアーキテクチャのサポート(RX,RL78...etc)
- GDBを使わないトレース
- PDB形式のサポート

# ソースコードについて
`covme` は go言語で開発していますが、ソースコードは今のところ公開していません。
これは現状の技術的な理由によって、専門用語でいうところの「クソみたいなコード」(a.k.a `クソコード`)として実装されているためです。
`covme` の実装がある程度おクリーンでお上品なコードになった時点でのソースコードの公開を予定しています。

# 使用しているOSSについて
[oss.md](https://github.com/simotin13/covme/blob/main/oss.md) をご参照ください。

# コントリビューションについて
改善要望・バグ報告を歓迎しています。GithubのIssueの投稿により要望やバグ報告をしてください。
内容によってはお答えできない場合があるかもしれません。あらかじめご了承お願い致します。

なお `covme` のデバッグのため、計測対象のプログラムのソースコード・モジュールのご提供をお願いすることがあるかもしれません。可能な方はご協力の程お願い致します。
